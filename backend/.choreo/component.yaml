# +required The configuration file schema version
schemaVersion: 1.2

# +required Choreo component implementation type
implementation: Service

# +optional Build configuration
build:
  buildType: dockerfile
  dockerfilePath: Dockerfile
  dockerContext: .

# +optional Incoming connection details for the component
endpoints:
  - name: choreo-ai-api
    displayName: Choreo AI Assistant API
    service:
      basePath: /
      port: 9090
    type: REST
    networkVisibilities:
      - Public
    schemaFilePath: .choreo/openapi.yaml

# +optional Defines runtime configurations
configurations:
  env:
    # Azure OpenAI Configuration
    - name: AZURE_OPENAI_KEY
      valueFrom:
        configForm:
          displayName: Azure OpenAI API Key
          required: true
          type: secret

    - name: AZURE_OPENAI_ENDPOINT
      valueFrom:
        configForm:
          displayName: Azure OpenAI Endpoint URL
          required: true
          type: string

    - name: AZURE_OPENAI_DEPLOYMENT
      valueFrom:
        configForm:
          displayName: Azure OpenAI Chat Deployment Name
          required: true
          type: string

    - name: AZURE_OPENAI_EMBEDDINGS_DEPLOYMENT
      valueFrom:
        configForm:
          displayName: Azure OpenAI Embeddings Deployment Name
          required: true
          type: string

    - name: AZURE_OPENAI_API_VERSION
      valueFrom:
        configForm:
          displayName: Azure OpenAI API Version
          required: false
          type: string
          default: "2024-02-15-preview"

    # Milvus Configuration
    - name: MILVUS_URI
      valueFrom:
        configForm:
          displayName: Milvus URI
          required: true
          type: string

    - name: MILVUS_TOKEN
      valueFrom:
        configForm:
          displayName: Milvus Authentication Token
          required: true
          type: secret

    - name: MILVUS_COLLECTION_NAME
      valueFrom:
        configForm:
          displayName: Milvus Collection Name
          required: false
          type: string
          default: "choreo_developer_assistant"

    - name: MILVUS_DIMENSION
      valueFrom:
        configForm:
          displayName: Milvus Vector Dimension
          required: false
          type: number
          default: 1536

    - name: MILVUS_METRIC
      valueFrom:
        configForm:
          displayName: Milvus Distance Metric
          required: false
          type: string
          default: "COSINE"

    # GitHub Configuration
    - name: GITHUB_TOKEN
      valueFrom:
        configForm:
          displayName: GitHub Personal Access Token
          required: false
          type: secret

    # Optional Services
    - name: GOOGLE_VISION_API_KEY
      valueFrom:
        configForm:
          displayName: Google Vision API Key (Optional)
          required: false
          type: secret

    # Performance Tuning
    - name: ENABLE_LLM_SUMMARIZATION
      valueFrom:
        configForm:
          displayName: Enable LLM Summarization
          required: false
          type: string
          default: "true"

    - name: ENABLE_URL_VALIDATION
      valueFrom:
        configForm:
          displayName: Enable URL Validation
          required: false
          type: string
          default: "true"

    - name: URL_VALIDATION_TIMEOUT
      valueFrom:
        configForm:
          displayName: URL Validation Timeout (seconds)
          required: false
          type: number
          default: 5

    # Python Configuration
    - name: PYTHONPATH
      valueFrom:
        configForm:
          displayName: Python Path
          required: false
          type: string
          default: "/app"

    - name: PYTHONUNBUFFERED
      valueFrom:
        configForm:
          displayName: Python Unbuffered Mode
          required: false
          type: string
          default: "1"

    # Port Configuration (Choreo will inject this dynamically)
    # This is read by start.py to bind to the correct port
    - name: PORT
      valueFrom:
        configForm:
          displayName: Application Port
          required: false
          type: string
          default: "9090"

