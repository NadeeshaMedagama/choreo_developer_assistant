â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                  â•‘
â•‘         CHOREO BACKEND DEPLOYMENT - QUICK REFERENCE              â•‘
â•‘                   Fix for Error 102504                           â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ DEPLOYMENT CONTEXT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  You are deploying: backend/ directory (not root)
  Component config:   backend/.choreo/component.yaml
  Docker context:     backend/

âœ… FILES CREATED IN BACKEND DIRECTORY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  âœ“ backend/Dockerfile                 - Docker build configuration
  âœ“ backend/start.py                   - Reads PORT env variable
  âœ“ backend/BACKEND_DEPLOYMENT_FIX.md  - Full documentation

ğŸ“¦ DEPLOYMENT STRUCTURE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  backend/
  â”œâ”€â”€ .choreo/
  â”‚   â””â”€â”€ component.yaml     â† Choreo config (already exists)
  â”œâ”€â”€ Dockerfile             â† NEW - Docker config
  â”œâ”€â”€ start.py               â† NEW - PORT reader
  â”œâ”€â”€ app.py                 â† FastAPI app
  â””â”€â”€ choreo-ai-assistant/
      â””â”€â”€ requirements.txt

ğŸ”§ THE FIX
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  BEFORE: App binds to hardcoded port 9090
  AFTER:  App reads PORT from environment and binds dynamically

  backend/start.py:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ port = os.environ.get('PORT', '9090')                      â”‚
  â”‚ cmd = ['uvicorn', 'app:app', '--host', '0.0.0.0',          â”‚
  â”‚        '--port', port]                                     â”‚
  â”‚ subprocess.run(cmd)                                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸš€ DEPLOY COMMANDS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  cd "/home/nadeeshame/Projects/Choreo AI Assistant/choreo-ai-assistant"

  git add backend/Dockerfile backend/start.py backend/BACKEND_DEPLOYMENT_FIX.md

  git commit -m "Fix: Backend uses dynamic PORT for Choreo"

  git push origin main

ğŸ“‹ CHOREO CONSOLE CONFIGURATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  When deploying in Choreo:

  Build Configuration:
  â”œâ”€â”€ Project Path:     backend
  â”œâ”€â”€ Build Type:       Dockerfile
  â”œâ”€â”€ Dockerfile Path:  Dockerfile
  â””â”€â”€ Context:          .

  The component.yaml is already configured at:
  backend/.choreo/component.yaml

ğŸ”‘ REQUIRED ENVIRONMENT VARIABLES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  Configure these in Choreo (they're defined in component.yaml):

  Azure OpenAI:
  âœ“ AZURE_OPENAI_KEY
  âœ“ AZURE_OPENAI_ENDPOINT
  âœ“ AZURE_OPENAI_DEPLOYMENT
  âœ“ AZURE_OPENAI_EMBEDDINGS_DEPLOYMENT

  Milvus:
  âœ“ MILVUS_URI
  âœ“ MILVUS_TOKEN
  âœ“ MILVUS_COLLECTION_NAME

  Auto-provided:
  âœ“ PORT (dynamic) â† This is what we fixed!

âœ… SUCCESS INDICATORS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  In deployment logs, look for:

  ============================================================
  Starting Choreo AI Assistant Backend
  Port: <dynamic-port-number>
  Host: 0.0.0.0
  ============================================================
  Command: uvicorn app:app --host 0.0.0.0 --port <port>
  ============================================================
  INFO:     Started server process [1]
  INFO:     Application startup complete.
  INFO:     Uvicorn running on http://0.0.0.0:<port>

ğŸ§ª TEST AFTER DEPLOYMENT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  curl https://your-choreo-url/api/health

  Expected: {"status": "healthy", ...}

ğŸ“š FULL DOCUMENTATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  See: backend/BACKEND_DEPLOYMENT_FIX.md

  Includes:
  - Complete deployment steps
  - Environment variable details
  - Troubleshooting guide
  - Test procedures

âš ï¸ IMPORTANT NOTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  1. Deploy from BACKEND directory, not root
  2. Dockerfile is IN backend/ (backend/Dockerfile)
  3. start.py is IN backend/ (backend/start.py)
  4. Component config is at: backend/.choreo/component.yaml
  5. Health check has 90s startup period (services init)

ğŸ¯ KEY DIFFERENCES FROM ROOT DEPLOYMENT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  Root Deployment:              Backend Deployment:
  â”œâ”€â”€ Dockerfile at root        â”œâ”€â”€ Dockerfile in backend/
  â”œâ”€â”€ CMD: backend.app:app      â”œâ”€â”€ CMD: app:app
  â”œâ”€â”€ PYTHONPATH=/app           â”œâ”€â”€ PYTHONPATH=/app
  â””â”€â”€ Context: .                â””â”€â”€ Context: . (from backend)

  Backend deployment is SIMPLER! âœ“

âœ… READY TO DEPLOY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  [âœ“] backend/Dockerfile created
  [âœ“] backend/start.py created
  [âœ“] backend/.choreo/component.yaml exists
  [âœ“] start.py is executable
  [ ] Commit and push changes
  [ ] Deploy in Choreo console
  [ ] Configure environment variables
  [ ] Test endpoints

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    ğŸš€ READY FOR DEPLOYMENT                       â•‘
â•‘                                                                  â•‘
â•‘      "Upstream connection timeout" error is now FIXED!          â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

